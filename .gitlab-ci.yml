stages:
  - ğŸ§ª test
  - ğŸ£ deploy

unit-test:
  stage: ğŸ§ª test
  image: python:3.11
  before_script:
    - python --version
    - pip install -r requirements.txt
  script:
    - pytest

deploy:
  variables:
    PYPI_REPO_URL: "https://test.pypi.org/legacy/"
    PYPI_USERNAME: "USERNAME"
    PYPI_PASSWORD: "TOKEN"
  stage: ğŸ£ deploy
  only:
    - tags
  image: python:3.11
  before_script:
    - python --version
    - pip install -r requirements.txt
    - echo "Nous allons dÃ©ployer sur ${PYPI_REPO_URL}"
  script:
    - python -m build
    - twine check dist/*
    - twine upload --repository-url "${PYPI_REPO_URL}" -u "${PYPI_USERNAME}" -p "${PYPI_PASSWORD}" dist/*